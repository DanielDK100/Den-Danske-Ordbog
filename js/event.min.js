function klikHandler(e){var t=e.selectionText.replace(/\./g,"").replace(/,/g,"").replace(/\//g," ");$.each(t.split(" "),function(e,t){if(e>=4)return!1;var n={type:"basic",title:"",message:"",contextMessage:"",iconUrl:manifest.icons[128]};$.get(konfiguration.urlWs,{q:t}).done(function(e){var e=$(e).filter(".ar")[0],i=$(e).find(".head .k").first().text();i?(n.buttons=[{title:chrome.i18n.getMessage("eventSynonymerKnap")},{title:chrome.i18n.getMessage("eventAntonymerKnap")}],chrome.notifications.onButtonClicked.addListener(synonymAntonym),chrome.notifications.onButtonClicked.removeListener(visForslag)):(n.buttons=[{title:chrome.i18n.getMessage("eventVisOrdforslag")}],chrome.notifications.onButtonClicked.removeListener(synonymAntonym),chrome.notifications.onButtonClicked.addListener(visForslag)),n.title=i?i.trim().replace(/\d+/g,""):chrome.i18n.getMessage("extIngenResultater")+' "'+t+'"',n.message=$(e).find(".dtrn").first().text().trim(),n.contextMessage=$(e).find(".m").first().text()?$(e).find(".m").first().text().trim():$(e).find(".pos").first().text().trim()}).always(function(){_gaq.push(["_trackEvent","Søgning","Event",t]),chrome.notifications.create(t,n)})})}function synonymAntonym(e,t){var n={type:"list",title:"",message:"",iconUrl:manifest.icons[128],items:[]};$.get(konfiguration.urlWs,{q:e}).done(function(i){var i=$(i).filter(".ar")[0];switch(t){case 0:_gaq.push(["_trackEvent","Søgning","Event - synonym",e]),n.title=$(i).find(".head .k").first().text()?chrome.i18n.getMessage("eventSynonymer")+' "'+$(i).find(".head .k").first().text().trim().replace(/\d+/g,"")+'"':chrome.i18n.getMessage("extIngenResultater")+' "'+e+'"';var r=$(i).find(".synonym .k");r.length||n.items.push({title:chrome.i18n.getMessage("eventIngenSynonymer"),message:""}),$.each(r,function(e,t){n.items.push({title:$(t).text().trim().capitalize(),message:""})});break;case 1:_gaq.push(["_trackEvent","Søgning","Event - antonym",e]),n.title=$(i).find(".head .k").first().text()?chrome.i18n.getMessage("eventAntonymer")+'"'+$(i).find(".head .k").first().text().trim().replace(/\d+/g,"")+'"':chrome.i18n.getMessage("extIngenResultater")+' "'+e+'"';var s=$(i).find(".antonym .k");s.length||n.items.push({title:chrome.i18n.getMessage("eventIngenAntonymer"),message:""}),$.each(s,function(e,t){n.items.push({title:$(t).text().trim().capitalize(),message:""})})}}).always(function(){_gaq.push(["_trackEvent","Søgning","Event",e]),n.items=fjernDuplikationer(n.items),chrome.notifications.create(e,n)})}function visForslag(e){chrome.notifications.clear(e);var t=0;$.get(konfiguration.urlWs,{q:e}).done(function(e){var e=$(e).filter(".nomatch")[0];$.each($(e).find("ul li"),function(e,n){if(4>=t){n=$(n).text();var i={type:"basic",title:"",message:"",contextMessage:"",iconUrl:manifest.icons[128]};$.get(konfiguration.urlWs,{q:n}).done(function(e){var e=$(e).filter(".ar")[0],t=$(e).find(".head .k").first().text();i.title=t?t.trim().replace(/\d+/g,""):chrome.i18n.getMessage("extIngenResultater")+' "'+n+'"',i.message=$(e).find(".dtrn").first().text().trim(),i.contextMessage=$(e).find(".m").first().text()?$(e).find(".m").first().text().trim():$(e).find(".pos").first().text().trim()}).always(function(){_gaq.push(["_trackEvent","Søgning","Event - ordforslag",n]),chrome.notifications.create(n,i)})}t++})})}function fjernDuplikationer(e){for(var t={},n=e.length-1;n>=0;n--){var i=JSON.stringify(e[n]);t[i]?e.splice(n,1):t[i]=!0}return e}var manifest=chrome.runtime.getManifest();chrome.runtime.onInstalled.addListener(function(){chrome.contextMenus.create({title:chrome.i18n.getMessage("eventSlaaOp"),contexts:["selection"],id:"contextselection"})}),chrome.contextMenus.onClicked.addListener(klikHandler),chrome.notifications.onClicked.addListener(function(e){chrome.tabs.create({url:konfiguration.urlDenDanskeOrdbog+e},function(){_gaq.push(["_trackEvent","Søgning","Event - link",e]),chrome.notifications.clear(e)})}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};