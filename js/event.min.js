function klikHandler(e){ga("send","pageview","event.js");var t=e.selectionText.replace(/\./g,"").replace(/,/g,"").replace(/\//g," ");$.each(t.split(" "),function(e,t){if(e>=4)return!1;var n={type:"basic",title:"",message:"",contextMessage:"",iconUrl:manifest.icons[128]};$.get(konfiguration.urlWs,{q:t}).done(function(e){var e=$(e).filter(".ar")[0],i=$(e).find(".head .k").first().text();i?(n.buttons=[{title:chrome.i18n.getMessage("eventSynonymerKnap")},{title:chrome.i18n.getMessage("eventAntonymerKnap")}],chrome.notifications.onButtonClicked.addListener(synonymAntonym),chrome.notifications.onButtonClicked.removeListener(visForslag)):(n.buttons=[{title:chrome.i18n.getMessage("eventVisOrdforslag")}],chrome.notifications.onButtonClicked.removeListener(synonymAntonym),chrome.notifications.onButtonClicked.addListener(visForslag)),n.title=i?i.trim().replace(/\d+/g,""):chrome.i18n.getMessage("extIngenResultater")+' "'+t+'"',n.message=$(e).find(".dtrn").first().text().trim(),n.contextMessage=$(e).find(".m").first().text()?$(e).find(".m").first().text().trim():$(e).find(".pos").first().text().trim()}).always(function(){ga("send",{hitType:"event",eventCategory:"Søgning",eventAction:"Event",eventLabel:t}),chrome.notifications.create(t,n)})})}function synonymAntonym(e,t){var n={type:"list",title:"",message:"",iconUrl:manifest.icons[128],items:[]};$.get(konfiguration.urlWs,{q:e}).done(function(i){var i=$(i).filter(".ar")[0];switch(t){case 0:ga("send",{hitType:"event",eventCategory:"Søgning",eventAction:"Event - synonym",eventLabel:e}),n.title=$(i).find(".head .k").first().text()?chrome.i18n.getMessage("eventSynonymer")+' "'+$(i).find(".head .k").first().text().trim().replace(/\d+/g,"")+'"':chrome.i18n.getMessage("extIngenResultater")+' "'+e+'"';var s=$(i).find(".synonym .k");s.length||n.items.push({title:chrome.i18n.getMessage("eventIngenSynonymer"),message:""}),$.each(s,function(e,t){n.items.push({title:$(t).text().trim().capitalize(),message:""})});break;case 1:ga("send",{hitType:"event",eventCategory:"Søgning",eventAction:"Event - antonym",eventLabel:e}),n.title=$(i).find(".head .k").first().text()?chrome.i18n.getMessage("eventAntonymer")+'"'+$(i).find(".head .k").first().text().trim().replace(/\d+/g,"")+'"':chrome.i18n.getMessage("extIngenResultater")+' "'+e+'"';var r=$(i).find(".antonym .k");r.length||n.items.push({title:chrome.i18n.getMessage("eventIngenAntonymer"),message:""}),$.each(r,function(e,t){n.items.push({title:$(t).text().trim().capitalize(),message:""})})}}).always(function(){ga("send",{hitType:"event",eventCategory:"Søgning",eventAction:"Event",eventLabel:e}),n.items=fjernDuplikationer(n.items),chrome.notifications.create(e,n)})}function visForslag(e){chrome.notifications.clear(e),$.get(konfiguration.urlWs,{q:e}).done(function(e){var e=$(e).filter(".nomatch")[0];$.each($(e).find("ul li"),function(e,t){if(e>=4)return!1;t=$(t).text();var n={type:"basic",title:"",message:"",contextMessage:"",iconUrl:manifest.icons[128]};$.get(konfiguration.urlWs,{q:t}).done(function(e){var e=$(e).filter(".ar")[0],i=$(e).find(".head .k").first().text();n.title=i?i.trim().replace(/\d+/g,""):chrome.i18n.getMessage("extIngenResultater")+' "'+t+'"',n.message=$(e).find(".dtrn").first().text().trim(),n.contextMessage=$(e).find(".m").first().text()?$(e).find(".m").first().text().trim():$(e).find(".pos").first().text().trim()}).always(function(){ga("send",{hitType:"event",eventCategory:"Søgning",eventAction:"Event - ordforslag",eventLabel:t}),chrome.notifications.create(t,n)})})})}function fjernDuplikationer(e){for(var t={},n=e.length-1;n>=0;n--){var i=JSON.stringify(e[n]);t[i]?e.splice(n,1):t[i]=!0}return e}chrome.runtime.setUninstallURL("http://danielwinther.dk/den-danske-ordbog/afinstallation");var manifest=chrome.runtime.getManifest();chrome.contextMenus.create({title:chrome.i18n.getMessage("eventSlaaOp"),contexts:["selection"],id:"contextselection"}),chrome.contextMenus.onClicked.addListener(klikHandler),chrome.notifications.onClicked.addListener(function(e){chrome.tabs.create({url:konfiguration.urlDenDanskeOrdbog+e},function(){ga("send",{hitType:"event",eventCategory:"Søgning",eventAction:"Event - link",eventLabel:e}),chrome.notifications.clear(e)})}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};